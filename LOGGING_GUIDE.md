# GeminiCraftChat æ—¥å¿—ç³»ç»Ÿä½¿ç”¨æŒ‡å—

> **æ³¨æ„**: è¿™æ˜¯ä¸­æ–‡ç‰ˆæ–‡æ¡£ã€‚[English version](docs/en/LOGGING_GUIDE.md) | [è¿”å›žæ–‡æ¡£é¦–é¡µ](docs/README.md)

## æ¦‚è¿°

GeminiCraftChat æ’ä»¶å†…ç½®äº†å®Œæ•´çš„æ—¥å¿—ç³»ç»Ÿï¼Œå¯ä»¥è®°å½•æ‰€æœ‰APIè°ƒç”¨ã€èŠå¤©è®°å½•ã€é”™è¯¯ä¿¡æ¯ã€æ€§èƒ½æ•°æ®å’ŒçŽ©å®¶ä½¿ç”¨ç»Ÿè®¡ã€‚

## æ—¥å¿—é…ç½®

### åŸºæœ¬é…ç½®

åœ¨ `config.yml` ä¸­çš„æ—¥å¿—é…ç½®ï¼š

```yaml
logging:
  enabled: true                    # å¯ç”¨/ç¦ç”¨æ—¥å¿—ç³»ç»Ÿ
  directory: "logs"                # æ—¥å¿—æ–‡ä»¶ç›®å½•
  format: "yyyy-MM-dd_HH-mm-ss"   # æ—¥å¿—æ–‡ä»¶åæ—¶é—´æ ¼å¼
  separate_files: true             # æ˜¯å¦åˆ†åˆ«ä¿å­˜ä¸åŒç±»åž‹çš„æ—¥å¿—
  retention_days: 30               # æ—¥å¿—ä¿ç•™å¤©æ•°ï¼ˆè‡ªåŠ¨æ¸…ç†ï¼‰
```

### æ—¥å¿—ç±»åž‹é…ç½®

```yaml
logging:
  include:
    chat: true                    # èŠå¤©è®°å½•
    commands: true                # å‘½ä»¤æ‰§è¡Œè®°å½•
    errors: true                  # é”™è¯¯è®°å½•
    model_changes: true           # æ¨¡åž‹åˆ‡æ¢è®°å½•
    temperature_changes: true     # æ¸©åº¦è°ƒæ•´è®°å½•
    api_calls: true               # APIè°ƒç”¨è®°å½•
    api_requests: true            # è¯¦ç»†çš„APIè¯·æ±‚å†…å®¹
    api_responses: true           # è¯¦ç»†çš„APIå“åº”å†…å®¹
    performance: true             # æ€§èƒ½ç»Ÿè®¡
    player_stats: true            # çŽ©å®¶ä½¿ç”¨ç»Ÿè®¡
```

### è¯¦ç»†ç¨‹åº¦è®¾ç½®

```yaml
logging:
  detail_level:
    api_requests: "full"          # full/headers_only/minimal
    api_responses: "content_only" # full/content_only/minimal
    performance: "summary"        # full/summary/minimal
```

## æ—¥å¿—æ–‡ä»¶ç»“æž„

### åˆ†ç¦»æ–‡ä»¶æ¨¡å¼ (separate_files: true)

å½“å¯ç”¨åˆ†ç¦»æ–‡ä»¶æ¨¡å¼æ—¶ï¼Œä¼šåˆ›å»ºä»¥ä¸‹æ—¥å¿—æ–‡ä»¶ï¼š

- `general_YYYY-MM-DD_HH-mm-ss.log` - ä¸€èˆ¬æ—¥å¿—ï¼ˆå‘½ä»¤ã€æ¨¡åž‹åˆ‡æ¢ç­‰ï¼‰
- `chat_YYYY-MM-DD_HH-mm-ss.log` - èŠå¤©è®°å½•
- `api_YYYY-MM-DD_HH-mm-ss.log` - APIè°ƒç”¨è¯¦ç»†è®°å½•
- `performance_YYYY-MM-DD_HH-mm-ss.log` - æ€§èƒ½æ•°æ®
- `errors_YYYY-MM-DD_HH-mm-ss.log` - é”™è¯¯è®°å½•
- `stats_YYYY-MM-DD_HH-mm-ss.log` - ç»Ÿè®¡ä¿¡æ¯

### ç»Ÿä¸€æ–‡ä»¶æ¨¡å¼ (separate_files: false)

æ‰€æœ‰æ—¥å¿—éƒ½è®°å½•åœ¨å•ä¸ªæ–‡ä»¶ä¸­ï¼š
- `log_YYYY-MM-DD_HH-mm-ss.log`

## æ—¥å¿—å†…å®¹ç¤ºä¾‹

### APIè°ƒç”¨è®°å½•

```
[2025-07-03 11:30:15.123] [APIè°ƒç”¨] çŽ©å®¶:Steve æ¨¡åž‹:APIæŽ¥å£1 URL:https://api.openai.com/v1/chat/completions å“åº”æ—¶é—´:1250ms çŠ¶æ€:æˆåŠŸ
[2025-07-03 11:30:15.124] [APIè¯·æ±‚] çŽ©å®¶:Steve æ¨¡åž‹:APIæŽ¥å£1
[2025-07-03 11:30:15.124]   URL: https://api.openai.com/v1/chat/completions
[2025-07-03 11:30:15.124]   è¯·æ±‚å¤´:
[2025-07-03 11:30:15.124]     Content-Type: application/json
[2025-07-03 11:30:15.124]     Authorization: Bearer ***
[2025-07-03 11:30:15.124]   è¯·æ±‚ä½“: {"model":"gpt-3.5-turbo","messages":[...],"temperature":0.7}
[2025-07-03 11:30:16.375] [APIå“åº”] çŽ©å®¶:Steve æ¨¡åž‹:APIæŽ¥å£1 çŠ¶æ€ç :200
[2025-07-03 11:30:16.375]   AIå›žå¤: ä½ å¥½ï¼æˆ‘æ˜¯AIåŠ©æ‰‹ï¼Œå¾ˆé«˜å…´ä¸ºä½ æœåŠ¡ã€‚
```

### èŠå¤©è®°å½•

```
[2025-07-03 11:30:15.120] [èŠå¤©] Steve > ä½ å¥½
[2025-07-03 11:30:16.375] [å›žå¤] ä½ å¥½ï¼æˆ‘æ˜¯AIåŠ©æ‰‹ï¼Œå¾ˆé«˜å…´ä¸ºä½ æœåŠ¡ã€‚
```

### æ€§èƒ½ç»Ÿè®¡

```
[2025-07-03 11:35:00.000] [æ€§èƒ½æ±‡æ€»] æ€»è°ƒç”¨:100 æˆåŠŸçŽ‡:98.00% å¹³å‡å“åº”æ—¶é—´:1150ms
```

### çŽ©å®¶ç»Ÿè®¡

```
[2025-07-03 12:00:00.000] === çŽ©å®¶ä½¿ç”¨ç»Ÿè®¡ ===
[2025-07-03 12:00:00.000] çŽ©å®¶ Steve: 25 æ¬¡è°ƒç”¨
[2025-07-03 12:00:00.000] çŽ©å®¶ Alex: 18 æ¬¡è°ƒç”¨
[2025-07-03 12:00:00.000] === æ¨¡åž‹ä½¿ç”¨ç»Ÿè®¡ ===
[2025-07-03 12:00:00.000] æ¨¡åž‹ api1: 30 æ¬¡ä½¿ç”¨
[2025-07-03 12:00:00.000] æ¨¡åž‹ api2: 13 æ¬¡ä½¿ç”¨
```

## å‘½ä»¤ä½¿ç”¨

### æŸ¥çœ‹ç»Ÿè®¡ä¿¡æ¯

```
/gcc logs stats
```

æ˜¾ç¤ºå½“å‰çš„æ—¥å¿—ç»Ÿè®¡ä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼š
- æ€»APIè°ƒç”¨æ¬¡æ•°
- æ€»é”™è¯¯æ¬¡æ•°
- æ´»è·ƒçŽ©å®¶æ•°
- ä½¿ç”¨çš„æ¨¡åž‹æ•°
- æˆåŠŸçŽ‡
- å¹³å‡å“åº”æ—¶é—´
- æ—¥å¿—é…ç½®çŠ¶æ€

### é‡ç½®ç»Ÿè®¡æ•°æ®

```
/gcc logs reset
```

æ¸…ç©ºæ‰€æœ‰ç»Ÿè®¡è®¡æ•°å™¨ï¼Œé‡æ–°å¼€å§‹ç»Ÿè®¡ã€‚

### å¯¼å‡ºçŽ©å®¶ç»Ÿè®¡

```
/gcc logs export
```

å°†å½“å‰çš„çŽ©å®¶ä½¿ç”¨ç»Ÿè®¡å’Œæ¨¡åž‹ä½¿ç”¨ç»Ÿè®¡å¯¼å‡ºåˆ°æ—¥å¿—æ–‡ä»¶ä¸­ã€‚

## æƒé™è¦æ±‚

- æŸ¥çœ‹æ—¥å¿—ç»Ÿè®¡ï¼š`gcc.admin`
- é‡ç½®ç»Ÿè®¡æ•°æ®ï¼š`gcc.admin`
- å¯¼å‡ºç»Ÿè®¡ä¿¡æ¯ï¼š`gcc.admin`

## è‡ªåŠ¨æ¸…ç†

ç³»ç»Ÿä¼šæ ¹æ® `retention_days` é…ç½®è‡ªåŠ¨æ¸…ç†è¿‡æœŸçš„æ—¥å¿—æ–‡ä»¶ã€‚åœ¨æ’ä»¶å¯åŠ¨æ—¶ä¼šæ£€æŸ¥å¹¶åˆ é™¤è¶…è¿‡ä¿ç•™å¤©æ•°çš„æ—¥å¿—æ–‡ä»¶ã€‚

## æ€§èƒ½å½±å“

- æ—¥å¿—ç³»ç»Ÿä½¿ç”¨å¼‚æ­¥å†™å…¥ï¼Œå¯¹æ¸¸æˆæ€§èƒ½å½±å“æžå°
- å¯ä»¥é€šè¿‡è°ƒæ•´ `detail_level` æ¥æŽ§åˆ¶æ—¥å¿—è¯¦ç»†ç¨‹åº¦
- å»ºè®®åœ¨ç”Ÿäº§çŽ¯å¢ƒä¸­ä½¿ç”¨ `minimal` æˆ– `summary` æ¨¡å¼

## æ•…éšœæŽ’é™¤

### æ—¥å¿—æ–‡ä»¶æœªåˆ›å»º

1. æ£€æŸ¥ `logging.enabled` æ˜¯å¦ä¸º `true`
2. ç¡®è®¤æ’ä»¶æœ‰å†™å…¥æƒé™
3. æŸ¥çœ‹æŽ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯

### æ—¥å¿—æ–‡ä»¶è¿‡å¤§

1. è°ƒæ•´ `retention_days` å‡å°‘ä¿ç•™å¤©æ•°
2. è®¾ç½® `detail_level` ä¸º `minimal`
3. ç¦ç”¨ä¸éœ€è¦çš„æ—¥å¿—ç±»åž‹

### ç»Ÿè®¡æ•°æ®ä¸å‡†ç¡®

1. ä½¿ç”¨ `/gcc logs reset` é‡ç½®ç»Ÿè®¡
2. æ£€æŸ¥æ˜¯å¦æœ‰å¤šä¸ªæœåŠ¡å™¨å®žä¾‹
3. ç¡®è®¤é…ç½®æ–‡ä»¶ä¸­çš„æ—¥å¿—è®¾ç½®æ­£ç¡®

## æœ€ä½³å®žè·µ

1. **ç”Ÿäº§çŽ¯å¢ƒ**ï¼šä½¿ç”¨ `separate_files: true` ä¾¿äºŽåˆ†æž
2. **å¼€å‘çŽ¯å¢ƒ**ï¼šå¯ç”¨æ‰€æœ‰æ—¥å¿—ç±»åž‹å’Œ `full` è¯¦ç»†æ¨¡å¼
3. **å®šæœŸå¤‡ä»½**ï¼šé‡è¦çš„æ—¥å¿—æ–‡ä»¶åº”å®šæœŸå¤‡ä»½
4. **ç›‘æŽ§ç£ç›˜ç©ºé—´**ï¼šè®¾ç½®åˆé€‚çš„ `retention_days` é¿å…ç£ç›˜æ»¡
5. **æ€§èƒ½ä¼˜åŒ–**ï¼šæ ¹æ®éœ€è¦è°ƒæ•´æ—¥å¿—è¯¦ç»†ç¨‹åº¦

## æ—¥å¿—åˆ†æž

å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å·¥å…·åˆ†æžæ—¥å¿—ï¼š

- `grep` å‘½ä»¤è¿‡æ»¤ç‰¹å®šå†…å®¹
- `awk` ç»Ÿè®¡æ•°æ®
- æ—¥å¿—åˆ†æžå·¥å…·å¦‚ ELK Stack
- è‡ªå®šä¹‰è„šæœ¬åˆ†æžæ€§èƒ½è¶‹åŠ¿

ç¤ºä¾‹ï¼š
```bash
# ç»Ÿè®¡æŸçŽ©å®¶çš„è°ƒç”¨æ¬¡æ•°
grep "çŽ©å®¶:Steve" api_*.log | wc -l

# æŸ¥çœ‹é”™è¯¯è®°å½•
grep "é”™è¯¯" errors_*.log

# åˆ†æžå“åº”æ—¶é—´
grep "å“åº”æ—¶é—´" api_*.log | awk '{print $8}' | sort -n
```

---

**å…¨é¢çš„æ—¥å¿—è®°å½•ï¼ŒèŽ·å¾—æ›´å¥½çš„æ´žå¯Ÿï¼ðŸ“ŠðŸ“‹**

> **å®Œæ•´æ–‡æ¡£**: [English](docs/en/LOGGING_GUIDE.md) | [ä¸­æ–‡](docs/zh/LOGGING_GUIDE.md) | [è¿”å›žæ–‡æ¡£é¦–é¡µ](docs/README.md)
