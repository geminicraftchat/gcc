# GeminiCraftChat v1.0.8 - NPC功能完整实现

## 🎉 版本概览

**版本**: 1.0.8  
**发布日期**: 2025-08-11  
**主要新功能**: AI控制的游戏内NPC对话系统  
**插件大小**: 3.8MB  

## 🆕 核心新功能

### 1. AI控制的NPC系统
- ✅ **智能NPC**: AI驱动的NPC行为和对话
- ✅ **多种行为状态**: 空闲、游荡、跟随、对话、逃跑、巡逻等
- ✅ **动态决策**: AI实时决定NPC的移动和行为
- ✅ **个性化对话**: 每个NPC都有独特的人设和对话风格
- ✅ **持久记忆**: NPC记住与每个玩家的对话历史

### 2. NPC行为系统
- **9种行为状态**:
  - `IDLE` - 空闲观察
  - `WANDERING` - 随机游荡
  - `FOLLOWING` - 跟随玩家
  - `TALKING` - 对话中
  - `MOVING_TO` - 移动到指定位置
  - `FLEEING` - 逃跑
  - `ATTACKING` - 攻击（可配置）
  - `SLEEPING` - 休息状态
  - `PATROLLING` - 巡逻

- **智能移动系统**:
  - 8个方向移动（北、南、东、西、东北、西北、东南、西南）
  - 垂直移动（上、下，支持飞行NPC）
  - 路径规划和障碍避免
  - 游荡范围限制

### 3. AI决策引擎
- **智能提示词系统**: 内置专门的NPC行为和对话提示词
- **环境感知**: NPC能感知时间、天气、生物群系、附近玩家
- **动态决策**: 基于当前状态和环境做出智能决策
- **个性化行为**: 不同人设的NPC表现出不同的行为模式

## 🎮 玩家交互功能

### 1. NPC对话系统
- **右键交互**: 玩家右键点击NPC开始对话
- **命令对话**: `/gcc npc chat <NPC ID> <消息>` 命令对话
- **聊天对话**: 在聊天中直接与NPC对话
- **对话历史**: 每个玩家独立的对话记录
- **智能回复**: AI生成的个性化回复

### 2. NPC管理命令
- `/gcc npc list` - 查看所有NPC
- `/gcc npc info <NPC ID>` - 查看NPC详细信息
- `/gcc npc chat <NPC ID> <消息>` - 与NPC对话
- `/gcc npc nearby` - 查看附近的NPC
- `/gcc npc spawn <NPC ID>` - 重新生成NPC（管理员）
- `/gcc npc remove <NPC ID>` - 移除NPC（管理员）
- `/gcc npc reload` - 重新加载NPC配置（管理员）

## ⚙️ 配置系统

### 1. NPC基础配置
```yaml
npc:
  enabled: true  # 启用NPC功能
  ai_update_interval: 20  # AI更新间隔（tick）
  nearby_range: 20.0  # 附近NPC查询范围
  broadcast_death: false  # 是否广播NPC死亡
```

### 2. NPC实例配置
每个NPC支持完整的配置定制：
- **基础属性**: 显示名称、实体类型、人设、API模型
- **生成位置**: 世界、坐标、朝向
- **行为配置**: 移动速度、交互范围、决策间隔
- **能力设置**: 飞行、游泳、攀爬、传送
- **生存设置**: 血量、无敌模式、重生延迟
- **时间设置**: 昼夜活跃时间
- **社交设置**: 对玩家友好度、跟随行为
- **AI权重**: 不同行为的优先级权重

### 3. 示例NPC配置
插件内置两个示例NPC：
- **村庄向导** (`village_guide`): 友好的村民向导
- **神秘法师** (`mysterious_mage`): 夜行的神秘法师

## 🎭 人设系统扩展

新增4个NPC专用人设：
- **友好向导** (`friendly_guide`): 热情的村庄向导
- **神秘法师** (`mysterious_mage`): 神秘的魔法师
- **守卫队长** (`guard_captain`): 严肃的守卫队长
- **商人** (`merchant_trader`): 精明的商人

## 🔐 权限系统

新增NPC相关权限：
- `gcc.npc.interact` - 允许与NPC交互（默认：所有玩家）
- `gcc.npc.chat` - 允许与NPC对话（默认：所有玩家）
- `gcc.npc.nearby` - 允许查看附近NPC（默认：所有玩家）
- `gcc.npc.manage` - 允许管理NPC（默认：管理员）
- `gcc.npc.damage` - 允许伤害NPC（默认：管理员）

## 🏗️ 技术架构

### 1. 核心类结构
- **AIControlledNPC**: NPC数据模型和状态管理
- **NPCBehaviorConfig**: NPC行为配置类
- **NPCManager**: NPC生命周期管理
- **NPCAIDecisionMaker**: AI决策引擎
- **NPCListener**: NPC事件监听器

### 2. AI集成
- **智能提示词**: 专门设计的NPC行为和对话提示词
- **多API支持**: 支持所有已配置的AI模型
- **异步处理**: 所有AI请求异步执行，不阻塞服务器
- **错误处理**: 完善的错误处理和降级机制

### 3. 性能优化
- **高效更新**: 智能的AI更新间隔控制
- **内存管理**: 自动清理过期的对话历史
- **异步架构**: 所有耗时操作异步执行
- **资源控制**: 合理的NPC数量和行为频率限制

## 🎯 使用场景

### 1. 服务器增强
- **新手引导**: 友好的NPC向导帮助新玩家
- **世界丰富**: 让世界更加生动和有趣
- **角色扮演**: 支持RPG服务器的沉浸式体验
- **互动娱乐**: 提供独特的AI对话体验

### 2. 教育应用
- **语言学习**: 与AI NPC练习对话
- **知识问答**: NPC可以回答各种问题
- **历史角色**: 扮演历史人物进行教育互动
- **创意写作**: 激发玩家的创意和想象力

## 🔧 安装和配置

### 1. 安装步骤
1. 下载 `geminicraftchat-1.0.8.jar`
2. 放入服务器 `plugins` 文件夹
3. 重启服务器生成配置文件
4. 配置API密钥和NPC设置
5. 使用 `/gcc reload` 重新加载配置

### 2. 快速开始
1. 确保至少配置一个API接口
2. 在配置文件中启用NPC功能：`npc.enabled: true`
3. 根据需要修改示例NPC的生成位置
4. 重新加载配置：`/gcc reload`
5. 使用 `/gcc npc list` 查看NPC状态

## 🐛 已知限制

### 1. 当前版本限制
- AI决策暂时使用简化实现（将在后续版本完善）
- NPC移动使用传送实现（未来可能改为平滑移动）
- 对话系统需要配置有效的AI API

### 2. 性能考虑
- 建议每个世界不超过10个活跃NPC
- AI更新间隔建议不低于20 tick（1秒）
- 大型服务器建议适当增加决策间隔

## 🚀 未来计划

### 1. 功能增强
- **完整AI集成**: 完善AI决策和对话系统
- **平滑移动**: 实现更自然的NPC移动
- **任务系统**: NPC可以给玩家分配任务
- **物品交互**: NPC可以给予或接收物品

### 2. 性能优化
- **智能休眠**: 无玩家时NPC自动休眠
- **区域加载**: 按需加载和卸载NPC
- **批量处理**: 优化大量NPC的处理效率

## 📊 版本统计

- **新增文件**: 5个核心类文件
- **修改文件**: 4个现有文件
- **新增配置**: 100+行NPC配置
- **新增权限**: 5个NPC权限
- **新增命令**: 7个NPC子命令
- **新增人设**: 4个NPC专用人设

## 🎉 总结

GeminiCraftChat v1.0.8 成功实现了完整的AI控制NPC系统，为Minecraft服务器带来了前所未有的智能交互体验。这个版本不仅保持了插件的轻量级特性（仅3.8MB），还提供了强大的可配置性和扩展性。

NPC系统的加入让服务器世界更加生动有趣，为玩家提供了全新的AI对话体验。无论是用于娱乐、教育还是角色扮演，这个功能都能为服务器带来独特的价值。

**立即体验AI NPC的魅力，让你的Minecraft世界充满智慧！** 🤖✨
