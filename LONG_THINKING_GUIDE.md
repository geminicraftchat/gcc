# GeminiCraftChat 长思考功能指南

> **注意**: 这是中文版文档。[English version](docs/en/LONG_THINKING_GUIDE.md) | [返回文档首页](docs/README.md)

## 概述

长思考功能允许AI模型花费更多时间进行深度思考，特别适合处理复杂问题、创意写作、代码分析等需要深度推理的任务。每个API接口都可以独立配置超时设置和长思考模式。

## 功能特点

### ✨ 主要特性

1. **独立配置**：每个API接口都有独立的超时设置
2. **灵活切换**：可以动态开启/关闭长思考模式
3. **智能超时**：根据模型特性配置不同的超时时间
4. **实时管理**：通过命令实时查看和管理超时设置
5. **日志记录**：所有超时相关操作都会被记录

### 🔧 技术实现

- **多客户端架构**：为每个模型创建专用的HTTP客户端
- **动态超时**：根据配置动态调整连接、读取、写入超时
- **内存优化**：客户端复用和智能缓存机制
- **优雅关闭**：确保所有客户端正确关闭

## 配置说明

### 基础配置结构

```yaml
api:
  models:
    api1:
      name: "GPT-3.5 Turbo"
      model: "gpt-3.5-turbo"
      base_url: "https://api.openai.com/v1/chat/completions"
      api_key: "your-api-key-here"
      max_tokens: 4096
      temperature: 0.7
      # 超时设置（秒）
      timeout:
        connect: 30           # 连接超时
        read: 60             # 读取超时
        write: 30            # 写入超时
        long_thinking: false # 长思考模式开关
```

### 超时参数详解

#### connect（连接超时）
- **作用**：建立HTTP连接的最大等待时间
- **推荐值**：30秒
- **说明**：通常不需要修改，除非网络环境特殊

#### read（读取超时）
- **作用**：等待API响应的最大时间
- **推荐值**：
  - 快速模型：60-90秒
  - 思考型模型：120-300秒
  - 超大模型：300-600秒
- **说明**：这是最重要的参数，直接影响长思考能力

#### write（写入超时）
- **作用**：发送请求数据的最大等待时间
- **推荐值**：30秒
- **说明**：通常不需要修改

#### long_thinking（长思考模式）
- **作用**：是否启用长思考模式的标识
- **值**：true/false
- **说明**：启用后会在日志中显示特殊标记

### 不同模型的推荐配置

#### 快速响应模型（GPT-3.5、Gemini Flash）
```yaml
timeout:
  connect: 30
  read: 60
  write: 30
  long_thinking: false
```

#### 平衡型模型（GPT-4、Claude Sonnet）
```yaml
timeout:
  connect: 30
  read: 120
  write: 30
  long_thinking: true
```

#### 思考型模型（Claude Opus、GPT-4o、DeepSeek R1）
```yaml
timeout:
  connect: 30
  read: 300
  write: 30
  long_thinking: true
```

#### 超大模型或特殊场景
```yaml
timeout:
  connect: 30
  read: 600
  write: 30
  long_thinking: true
```

## 命令使用

### 查看所有模型的超时设置
```bash
/gcc timeout list
```

**输出示例**：
```
=== 模型超时设置列表 ===
- GPT-3.5 Turbo (api1)
  连接:30s, 读取:60s, 长思考:禁用
- Claude Sonnet (api2)
  连接:30s, 读取:180s, 长思考:启用
- 通义千问 (api3)
  连接:30s, 读取:120s, 长思考:启用
```

### 查看指定模型的详细信息
```bash
/gcc timeout info <模型名称>
```

**示例**：
```bash
/gcc timeout info api2
```

**输出示例**：
```
=== Claude Sonnet 超时设置详情 ===
模型标识: api2
连接超时: 30 秒
读取超时: 180 秒
写入超时: 30 秒
长思考模式: 启用
长思考模式允许AI花费更多时间进行深度思考，适合复杂问题。
```

### 切换长思考模式
```bash
/gcc timeout toggle <模型名称>
```

**示例**：
```bash
/gcc timeout toggle api1
```

**输出示例**：
```
已启用模型 GPT-3.5 Turbo 的长思考模式！
长思考模式已启用，读取超时时间: 60 秒
```

## 使用场景

### 🎯 适合长思考的场景

1. **复杂问题解决**
   - 数学证明
   - 逻辑推理
   - 算法设计

2. **创意写作**
   - 小说创作
   - 诗歌写作
   - 剧本编写

3. **代码分析**
   - 代码审查
   - 架构设计
   - 性能优化

4. **深度分析**
   - 文献综述
   - 数据分析
   - 战略规划

### ⚡ 适合快速响应的场景

1. **简单问答**
   - 基础知识查询
   - 快速翻译
   - 简单计算

2. **实时对话**
   - 闲聊互动
   - 游戏指导
   - 即时帮助

3. **批量处理**
   - 数据转换
   - 格式化
   - 简单分类

## 最佳实践

### 🔧 配置建议

1. **根据用途配置**
   - 游戏服务器：使用快速响应配置
   - 学习辅助：使用长思考配置
   - 混合用途：配置多个模型

2. **监控和调整**
   - 定期查看日志统计
   - 根据实际使用情况调整超时
   - 关注错误率和响应时间

3. **资源管理**
   - 避免设置过长的超时时间
   - 合理配置并发连接数
   - 定期清理历史记录

### 📊 性能优化

1. **超时时间设置**
   ```yaml
   # 保守设置（适合稳定环境）
   read: 120
   
   # 激进设置（适合高性能需求）
   read: 300
   
   # 极限设置（适合特殊场景）
   read: 600
   ```

2. **网络优化**
   - 使用稳定的网络连接
   - 配置合适的代理设置
   - 监控网络延迟

3. **模型选择**
   - 根据任务复杂度选择模型
   - 平衡响应时间和质量
   - 考虑成本因素

## 故障排除

### 常见问题

#### 1. 超时错误频繁出现
**症状**：API调用经常超时
**解决方案**：
- 增加读取超时时间
- 检查网络连接稳定性
- 启用长思考模式

#### 2. 响应时间过长
**症状**：AI响应很慢但不超时
**解决方案**：
- 适当减少读取超时
- 切换到更快的模型
- 优化提示词复杂度

#### 3. 长思考模式无效
**症状**：启用长思考但没有改善
**解决方案**：
- 检查配置文件是否正确
- 重新加载配置
- 查看调试日志

### 调试方法

1. **启用调试模式**
   ```bash
   /gcc debug
   ```

2. **查看日志统计**
   ```bash
   /gcc logs stats
   ```

3. **检查配置**
   ```bash
   /gcc timeout list
   /gcc timeout info <模型名称>
   ```

## 日志和监控

### 日志记录

长思考功能会在以下情况记录日志：

1. **模型客户端创建**
   ```
   [DEBUG] 为模型 api2 创建专用客户端 - 连接:30s, 读取:180s, 写入:30s
   ```

2. **长思考模式启用**
   ```
   [DEBUG] 模型 api2 启用长思考模式，读取超时: 180秒
   [DEBUG] 使用长思考模式发送请求到 Claude Sonnet，读取超时: 180秒
   ```

3. **命令执行**
   ```
   [INFO] 玩家 player1 执行命令: timeout toggle api2 -> 启用
   ```

### 统计监控

通过 `/gcc logs stats` 可以查看：
- 平均响应时间
- 超时错误率
- 模型使用分布
- 成功率统计

## 更新日志

### v1.0.6 新增功能
- ✅ 添加长思考功能
- ✅ 支持每个API接口独立超时配置
- ✅ 新增超时管理命令
- ✅ 多客户端架构优化
- ✅ 完善日志记录和监控

---

通过合理配置长思考功能，你可以让AI在处理复杂问题时有更充足的思考时间，从而获得更高质量的回答。记住要根据实际使用场景和网络环境来调整超时设置！

---

**深度思考，成就更多！🧠⚡**

> **完整文档**: [English](docs/en/LONG_THINKING_GUIDE.md) | [中文](docs/zh/LONG_THINKING_GUIDE.md) | [返回文档首页](docs/README.md)
